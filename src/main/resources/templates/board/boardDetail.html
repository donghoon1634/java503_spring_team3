<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
            integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
            integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
            crossorigin="anonymous"></script>
    <title>Title</title>
    <style>
        /* ìƒë‹¨ í™ˆ>ë™ë„¤ìƒí™œ ì—ì„œ > ì´ë¯¸ì§€ */
        li > img {
            width: 12px;
            height: 12px;
            margin-bottom: -10px;
            padding-right: 1px;
        }

        /* ê²Œì‹œê¸€ ìƒíƒœ ì¹´í…Œê³ ë¦¬ */
        #ulCate {
            color: gray;
            border: 1px none;
            background-color: lightgray;
            height: 20px;
            width: 54px;
            margin-left: -4px;
            font-size: 12px;
        }

        /* ê²Œì‹œê¸€ ë‹‰ë„¤ì„ */
        #ulNickname {
            font-size: 14px;
            font-weight: bold;
            width: 100%;
        }

        /* ê²Œì‹œê¸€ ìœ„ì¹˜,ë‚ ì§œ */
        .small-text {
            font-size: 12px;
            color: gray;
        }

        /* ê²Œì‹œê¸€ ì œëª© */
        #ulTitle {
            border: none;
            font-weight: bold;
        }

    </style>

    <script>
        $(document).ready(function () {
            ax();
            // ìˆ˜ì •
            $("#btn-update").on("click", function () {
                $("#method").val("PUT");

                var frm = $("#frm")[0];

                if (!frm) {
                    console.error("í¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                    alert("í¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                    return;
                }

                frm.action = "/board/" + $("#ulIdx").val();
                frm.submit();
            });
            // ì‚­ì œ
            $("#btn-delete").on("click", function () {
                $("#method").val("DELETE");

                var frm = $("#frm")[0];

                if (!frm) {
                    console.error("í¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                    alert("í¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                    return;
                }

                frm.action = "/board/" + $("#ulIdx").val();
                frm.submit();
            });
            // ëª©ë¡
            $("#btn-list").on("click", function () {
                history.back();
            });
            // ì¶”ì²œìˆ˜
            $('#ulLikes').click(function () {
                var result = confirm("ì¶”ì²œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
                if (result = true) {
                    // ê¸€ë²ˆí˜¸ ê°€ì ¸ì˜¤ê¸°
                    var ulIdx = $("#ulIdx").val();
                    $.ajax({
                        url: '/board/api/blog/' + ulIdx,
                        method: 'POST',
                        success: function (data) {
                            $('#ulLikes').text(data);
                            var suc = confirm("ì¶”ì²œí•˜ì˜€ìŠµë‹ˆë‹¤!");
                        }
                    })
                }
            });
        });

        function ax() {
            $.ajax({
                url: "/board/api/popular", // ğŸ”¹ ì¸ê¸°ê¸€ì„ ë¶ˆëŸ¬ì˜¬ API
                type: "GET",
                data: { limit: 5 }, // ğŸ”¹ ì¸ê¸°ê¸€ 5ê°œ ê°€ì ¸ì˜¤ê¸°
                success: function (data) {
                    console.log("ì¸ê¸°ê¸€ ë°ì´í„°:", data);

                    let popularList = $("#popular-posts");
                    popularList.empty(); // ğŸ”¹ ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”

                    // ğŸ”¹ ë°›ì•„ì˜¨ ë°ì´í„°ë¥¼ í•˜ë‚˜ì”© <li> íƒœê·¸ë¡œ ì¶”ê°€
                    data.forEach(ul => {
                        let listItem = `
                        <li class="popular-item">
                            <h3>${ul.ulTitle}</h3>
                            <p class="content">${ul.ulContents}</p>
                            <p class="info">${ul.ulPlace} Â· ${ul.ulCate}</p>
                            <div class="icons">
                            <img src="/img/good.png" width="22px" height="22px" alt="" id="ulLikes" name="ulLikes" ${ul.ulLikes}>
                            <img src="/img/commu.png" width="22px" height="22px" alt="">
                            </div>
                        </li>
                    `;
                        popularList.append(listItem);
                    });
                },
                error: function () {
                    alert("ì˜¤ë¥˜ ë°œìƒ! ì¸ê¸°ê¸€ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
                }
            });
        }

        // ğŸ”¹ í˜ì´ì§€ê°€ ë¡œë“œë  ë•Œ ìë™ìœ¼ë¡œ ì¸ê¸°ê¸€ ë¶ˆëŸ¬ì˜¤ê¸°
        $(document).ready(function () {
            ax();
        });
    </script>

</head>
<body>
<main class="container mt-5">
    <!-- ìƒë‹¨ í™ˆ > ë™ë„¤ìƒí™œ ë¶€ë¶„ -->
    <nav class="navbar navbar-expand-lg bg-white">
        <!-- id="navbarSupportedContent" í•„ìš”í•œ ë¶€ë¶„? -->
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="#">í™ˆ</a>
                </li>
                <li class="nav-item">
                    <img src="/img/free-icon-arrow-right-6423875.png">
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="">ë™ë„¤ìƒí™œ</a>
                </li>
            </ul>
        </div>
    </nav>

    <section class="row">
        <!-- ì¹´í…Œê³ ë¦¬ (cate) ì˜ì—­ -->
        <div class="col-md-2 p-3">
            <div th:replace="~{/layout/cate :: cate}"></div>
        </div>

        <!-- ì˜¤ë¥¸ìª½ ë©”ì¸ ì½˜í…ì¸  -->
        <div class="col-md-8" style="margin-left: 40px;">
            <form id="frm" method="post">
                <input type="hidden" id="method" name="_method">
                <!-- ê¸€ ì •ë³´ -->
                <!-- ì¹´í…Œê³ ë¦¬ -->
                <div class="mt-3">
                    <input type="text" id="ulCate" name="ulCate" placeholder="ì¹´í…Œê³ ë¦¬" th:value="${ul.ulCate}" readonly>
                    <label for="ulCate"></label>
                </div>
                <!-- í”„í¬í•„, ë‹‰ë„¤ì„, ìœ„ì¹˜, ë‚ ì§œ, ì‚­ì œ, ìˆ˜ì • -->
                <div class="row mt-2">
                    <div class="d-flex ps-2">
                        <!--  ëŒ“ê¸€ ì‘ì„±ì í”„ë¡œí•„ì‚¬ì§„ -->
                        <div class="col-sm-1">
                            <img src="/img/í”„ë¡œí•„.jpg" style="width: 50px; height: 50px" alt="í”„ë¡œí•„">
                        </div>
                        <div class="col-sm">
                            <!-- ë‹‰ë„¤ì„ ì…ë ¥ -->
                            <div class="col">
                                <p id="ulNickname" th:text="${ul.ulNickname}" class="m-0">ë‹‰ë„¤ì„</p>
                            </div>
                            <!--  ìœ„ì¹˜, ì‘ì„± ë‚ ì§œ, ìˆ˜ì • ë‚ ì§œ -->
                            <div class="row align-items-center mb-3">
                                <!-- ìœ„ì¹˜ -->
                                <div class="col-sm-1 pe-0">
                                    <p class="small-text" th:text="${ul.ulPlace}" style="width: 45px;">ìœ„ì¹˜</p>
                                </div>

                                <!-- ì‘ì„± ë‚ ì§œ -->
                                <div class="col p-0 ps-1 ">
                                    <p class="small-text" th:text="${ul.ulCreateDate}">ì‘ì„±ë‚ ì§œ</p>
                                </div>

                                <!-- ìˆ˜ì • ë‚ ì§œ -->
                                <div class="col">
                                    <p class="small-text" th:text="${ul.ulUpdateDate}">ìˆ˜ì •ë‚ ì§œ</p>
                                </div>
                            </div>
                        </div>

                        <!-- ì‚­ì œ ìˆ˜ì • ë²„íŠ¼ -->
                        <div class="col-sm-auto text-end">
                            <button type="button" class="btn btn-danger me-2" id="btn-delete">ì‚­ì œ</button>
                            <button type="button" class="btn btn-warning" id="btn-update">ìˆ˜ì •</button>
                        </div>

                    </div>
                </div>
                <!-- ê¸€ì œëª©-->
                <h3 class="row mt-1 ">
                    <input type="text" id="ulTitle" name="ulTitle" th:value="${ul.ulTitle}" readonly class="ps-2 p-0">
                    <label for="ulTitle"></label>
                </h3>
                <!-- ê¸€ ë‚´ìš© -->
                <div class="row mt-1  ">
                    <div class="col-sm">
                        <div class="form">
                            <textarea id="ulContents" name="ulContents" placeholder="ê¸€ ë‚´ìš©" class="form-control p-0" th:text="${ul.ulContents}" oninput="autoResize(this)" style="resize: none; overflow-y: hidden; height: auto; border: none"></textarea>
                            <label for="ulContents"></label>
                        </div>
                    </div>
                </div>
                <!-- ê¸€ë²ˆí˜¸(ì•ˆë³´ì„) -->
                <div class="row mt-3">
                    <p class="d-none" id="ulIdx" th:text="${ul.ulIdx}">ê¸€ë²ˆí˜¸ </p>
                </div>
                <!-- ì¶”ì²œ & ëŒ“ê¸€ -->
                <div>
                    <div class="row align-items-center mt-2">
                        <!-- ì¶”ì²œ -->
                        <div class="col-sm-auto d-flex align-items-center pe-0">
                            <img src="/img/good.png" width="22px" height="22px" alt="" id="ulLikes" name="ulLikes">
                            <div class="mb-0 ms-2" th:text="${ul.ulLikes}"></div>
                        </div>

                        <!-- ëŒ“ê¸€ -->
                        <div class="col-sm-auto d-flex align-items-center">
                            <img src="/img/commu.png" width="22px" height="22px" alt="">
                            <div class="mb-0 ms-2" >0</div>
                        </div>

                        <!-- ì¡°íšŒìˆ˜ -->
                        <div class="col-sm d-flex justify-content-end align-items-center"
                             style="font-size: 14px; color: #a0a0a0; font-weight: bold">
                            <p class="mb-0 me-2"><b>ì¡°íšŒ</b></p>
                            <div th:text="${ul.ulHitCnt}"></div>
                        </div>
                    </div>
                </div>
            </form>
            <script>
                function autoResize(element) {
                    element.style.height = 'auto';  // ê¸°ë³¸ ë†’ì´ë¥¼ ìë™ìœ¼ë¡œ ì„¤ì •
                    element.style.height = (element.scrollHeight) + 'px'; // ë‚´ìš©ì— ë§ê²Œ ë†’ì´ë¥¼ ì¡°ì •
                }
                // í˜ì´ì§€ ë¡œë“œ ì‹œ ë‚´ìš©ì— ë§ì¶° ë†’ì´ë¥¼ ìë™ ì¡°ì •
                window.addEventListener('load', function () {
                    var textarea = document.getElementById('ulContents');
                    autoResize(textarea);  // í˜ì´ì§€ ë¡œë”© ì‹œì—ë„ í¬ê¸° ì¡°ì •
                });
            </script>

            <hr>

            <!--             ëŒ“ê¸€ ìœ„ì¹˜-->
            <section th:replace="~{/layout/comment :: comment(${comments}, ${ul.ulIdx})}"> replaceë¡œ í• ê²½ìš°</section>


            <hr>
            <section>
                <div>
                    <div>
                        <h2><b>ë¬¸í˜„ì œ2ë™ ì¸ê¸°ê¸€</b></h2>
                    </div>
                    <!-- AJAXë¡œ ì¸ê¸°ê¸€ì´ ì—¬ê¸°ì— ì¶”ê°€ë¨ -->
                    <ul id="popular-posts">
                    </ul>
                </div>
            </section>


        </div>

    </section>

</main>
</body>
</html>